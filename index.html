<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Impostor ‚Äì gra s≈Çowna (1‚Äì10 os√≥b, jasny motyw)</title>
  <meta name="description" content="Gra s≈Çowna Impostor: 1‚Äì10 os√≥b, jedna osoba ma kartƒô IMPOSTOR. Losowanie has≈Ça po starcie rundy, op√≥≈∫nione przekazywanie urzƒÖdzenia z odliczaniem.">
  <style>
    :root {
      --gap: 14px; --radius: 14px;
      --bg: #f6f8fb; --text: #0f1a2b;
      --card: #ffffff; --border: #e5eaf2;
      --accent: #2952ff; --muted: #6b7a90;
      --chip: #f0f3f9;
    }
    * { box-sizing: border-box; }
    html,body { height: 100%; }
    body {
      margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: var(--bg); color: var(--text); line-height: 1.45;
      -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
    }
    header { padding: 22px 18px 10px; text-align: center; }
    h1 { margin: 0 0 6px; font-size: 22px; letter-spacing: .2px; }
    .wrap { max-width: 860px; margin: 0 auto; padding: 0 14px 24px; }
    .card {
      background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); padding: 16px;
      margin-top: var(--gap); box-shadow: 0 8px 24px rgba(15,26,43,.06);
    }
    .row { display: flex; flex-wrap: wrap; gap: var(--gap); }
    .row > * { flex: 1 1 260px; }
    label { display: block; font-size: 14px; color: var(--muted); margin-bottom: 6px; }
    input[type=text], select {
      width: 100%; padding: 12px 14px; border-radius: 10px; border: 1px solid var(--border);
      background: #fbfcfe; color: var(--text); outline: none;
    }
    input[type=checkbox] { transform: scale(1.05); }
    input[type=text]:focus, select:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(41,82,255,.12); }
    .btn {
      display: inline-flex; align-items: center; justify-content: center;
      gap: 8px; padding: 12px 16px; border-radius: 12px; border: 1px solid var(--border);
      color: var(--text); background: #f2f5fb; cursor: pointer; user-select: none;
      text-decoration: none; font-weight: 600;
    }
    .btn:hover { filter: brightness(1.02); }
    .btn.primary { background: var(--accent); border-color: var(--accent); color: #fff; }
    .btn.ghost { background: transparent; }
    .btn[disabled] { opacity: .5; cursor: not-allowed; }
    .btn-group { display:flex; gap: var(--gap); flex-wrap: wrap; }
    .meta { font-size: 13px; color: var(--muted); }
    .chips { display:flex; gap: 8px; flex-wrap: wrap; margin-top: 8px; }
    .chip { padding: 6px 10px; border-radius: 999px; background: var(--chip); border:1px solid var(--border); font-size: 13px; cursor:pointer;}
    .divider { height:1px; background: var(--border); margin: 14px -2px; }
    .hidden { display:none !important; }
    .big-word {
      font-size: clamp(28px, 8vw, 52px);
      letter-spacing: .06em; text-align: center; font-weight: 800;
      margin: 14px 0 6px; text-transform: uppercase;
    }
    .big-sub { text-align:center; color: var(--muted); margin-bottom: 8px; }
    .center { text-align:center; }
    .num {
      display:inline-flex; width: 28px; height: 28px; align-items:center; justify-content:center;
      background:#eef2ff; color:#233875; border-radius: 8px; border:1px solid var(--border); font-weight:700;
    }
    details summary { cursor: pointer; color: var(--muted); }
    footer { text-align:center; font-size: 12px; color: var(--muted); padding: 20px 0 40px; }
    .countdown {
      font-size: clamp(24px, 6vw, 40px); font-weight: 800; letter-spacing: .06em; text-align:center;
      margin-top: 10px;
    }
    .overlay {
      position: fixed; inset: 0; background: rgba(255,255,255,.92);
      display: flex; align-items: center; justify-content: center; padding: 20px;
      z-index: 50;
    }
    .overlay .box {
      background: #ffffff; border:1px solid var(--border); border-radius: 16px; padding: 20px; max-width: 520px;
      text-align: center; box-shadow: 0 10px 30px rgba(15,26,43,.08);
    }
  </style>
</head>
<body>
  <header>
    <h1>Impostor ‚Äì gra s≈Çowna (1‚Äì10 os√≥b)</h1>
    <div class="meta">Has≈Ço losuje siƒô <strong>po starcie rundy</strong>, wiƒôc nikt nie zobaczy go wcze≈õniej. Jedna losowa osoba ma kartƒô <strong>IMPOSTOR</strong>.</div>
  </header>

  <div class="wrap">
    <!-- USTAWIENIA RUNDY -->
    <div class="card" id="setup">
      <div class="row">
        <div>
          <label for="playersCount">Liczba graczy (1‚Äì10)</label>
          <select id="playersCount"></select>
        </div>
        <div>
          <label for="deferRandom">
            <input type="checkbox" id="deferRandom" checked />
            Losuj s≈Çowo dopiero po rozpoczƒôciu rundy (rekomendowane)
          </label>
          <label for="customWord">W≈Çasne s≈Çowo (aktywnie gdy powy≈ºej odznaczone)</label>
          <input type="text" id="customWord" placeholder="np. 'wulkan'" disabled>
          <div class="chips" id="chips"></div>
        </div>
        <div>
          <label for="revealOrder">Kolejno≈õƒá pokazywania</label>
          <select id="revealOrder"></select>
        </div>
        <div>
          <label for="delaySec">Op√≥≈∫nienie przekazania (sekundy)</label>
          <select id="delaySec">
            <option>5</option>
            <option>3</option>
            <option>7</option>
            <option>10</option>
          </select>
        </div>
      </div>
      <div class="divider"></div>
      <div class="btn-group">
        <button class="btn primary" id="startBtn">Rozpocznij rundƒô</button>
        <button class="btn" id="randomizeBtn" disabled>Losuj s≈Çowo teraz</button>
        <button class="btn ghost" id="howBtn">Zasady</button>
      </div>
      <div class="meta" id="wordPickedNote" style="margin-top:10px;"></div>
    </div>

    <!-- EKRAN GRACZA -->
    <div class="card hidden" id="playerScreen">
      <div class="center">
        <div class="big-sub">Teraz patrzy gracz <span id="playerNum" class="num">1</span></div>
        <div class="big-word" id="secretWord">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
        <div class="meta" id="impostorNote" style="text-transform:uppercase; font-weight:800;"></div>
        <div class="btn-group" style="justify-content:center; margin-top:12px;">
          <button class="btn primary" id="doneBtn" title="Kliknij po przeczytaniu has≈Ça">Przeczyta≈Çem ‚Äì przeka≈ºƒô</button>
        </div>
        <div class="meta" style="margin-top:8px;">
          Po klikniƒôciu przycisku nastƒÖpi <span id="delayLabel">5</span>s odliczanie, a potem s≈Çowo pojawi siƒô kolejnemu graczowi.
        </div>
      </div>
    </div>

    <!-- OVERLAY z odliczaniem -->
    <div class="overlay hidden" id="handoffOverlay" aria-hidden="true">
      <div class="box">
        <div class="big-sub">Przeka≈º urzƒÖdzenie nastƒôpnemu graczowi:</div>
        <div class="countdown"><span id="countdown">5</span>s</div>
        <div class="meta" style="margin-top:8px;">Nie podglƒÖdaj poza swojƒÖ kolejkƒÖ üôÇ</div>
      </div>
    </div>

    <!-- PANEL PROWADZƒÑCEGO -->
    <div class="card hidden" id="hostPanel">
      <div class="row">
        <div>
          <div class="meta">Runda trwa. Ujawniono: <span id="revealedCount">0</span>/<span id="totalPlayers">6</span></div>
          <div class="chips" id="orderChips"></div>
        </div>
        <div class="center" style="align-self:center;">
          <button class="btn" id="peekBtn">Podejrzyj s≈Çowo</button>
          <button class="btn ghost" id="maskBtn">Schowaj</button>
          <button class="btn primary" id="newRoundBtn">Nowa runda</button>
        </div>
      </div>
    </div>

    <!-- ZASADY -->
    <div class="card hidden" id="rules">
      <details open>
        <summary><strong>Jak graƒá (skr√≥t)</strong></summary>
        <ol>
          <li>Ustaw liczbƒô graczy. Zaznaczenie ‚ÄûLosuj po starcie‚Äù sprawia, ≈ºe nikt nie widzi has≈Ça wcze≈õniej.</li>
          <li>Po rozpoczƒôciu rundy s≈Çowo losuje siƒô automatycznie i od razu widzi je gracz 1 (albo ‚ÄûIMPOSTOR‚Äù).</li>
          <li>Po przeczytaniu gracz klika <strong>‚ÄûPrzeczyta≈Çem ‚Äì przeka≈ºƒô‚Äù</strong>, w≈ÇƒÖcza siƒô odliczanie i ekran siƒô chowa. Po nim s≈Çowo pojawia siƒô nastƒôpnemu.</li>
        </ol>
      </details>
    </div>

    <footer>Powodzenia i mi≈Çej zabawy! ‚Ä¢ Jasny motyw üå§Ô∏è</footer>
  </div>

  <script>
    // 300 hase≈Ç startowych
    const WORDS = [
"wulkan","jaskinia","wiatrak","kompas","kajak","mecz","safari","pustynia","bursztyn","≈õnie≈ºyca",
"astronauta","mikroskop","tornado","latarnia","zatoka","serowarnia","opera","biblioteka","wystawa","przysta≈Ñ",
"dron","akumulator","szachy","teleskop","papryczka","glina","gondola","pampas","≈ºagiel","baobab",
"igloo","sushi","fresk","fajerwerki","antena","podkowa","amfiteatr","trampolina","magma","pergamin",
"lornetka","balon","rakieta","wiolonczela","fortepian","≈ºyrafa","flaming","pingwin","krater","ksiƒô≈ºyc",
"tropik","neon","foka","kaktus","lawenda","ulica","fontanna","most","tramwaj","≈ºuraw",
"ratusz","kawiarnia","cukiernia","rynek","port","wodospad","rzeka","jezioro","p√≥≈Çwysep","klif",
"kopalnia","huta","fabryka","m≈Çyn","stodo≈Ça","szklarnia","winnica","sad","plantacja","pasieka",
"≈ºagl√≥wka","motor√≥wka","katamaran","jachty","dok","kotwica","bosak","ster","lina","boja",
"meduza","rafa","per≈Ça","latarnia_morska","foka_szara","albatros","orka","rekin","krab","konik_morski",
"suszarka","czajnik","toster","mikser","piekarnik","zmywarka","odkurzacz","≈ºelazko","pralka","lod√≥wka",
"zegarek","komputer","klawiatura","mysz","drukarka","s≈Çuchawki","mikrofon","kamera","tablet","smartfon",
"weso≈Çe_miasteczko","diabelski_m≈Çyn","kolejka_g√≥rska","karuzela","strzelnica","budka_z_lodami","namiot","ognisko","hamak","plecak",
"kompasik","mapa","lina_wspinaczkowa","czapka","buty_trek","latarka","koc","termos","krzesiwo","gwizdek",
"≈õnieg","ba≈Çwan","narty","snowboard","sanki","kurtka","gogle","stok","schronisko","≈õnie≈ºka",
"rower","hulajnoga","rolki","≈Çy≈ºworolki","kask","ochraniacze","pompka","≈Ça≈Ñcuch","dzwonek","b≈Çotnik",
"pi≈Çka_no≈ºna","bramka","rƒôkawice","koszulka","flaga","gwizdek_sƒôdziego","tablica_wynik√≥w","murawa","trybuny","kibic",
"koszyk√≥wka","siatk√≥wka","tenis","badminton","ping_pong","szermierka","≈Çucznictwo","wio≈õlarstwo","kajakarstwo","sztafeta",
"tango","walc","polonez","mazurek","krakowiak","breakdance","hiphop","flamenco","samba","rumba",
"farma","ko≈Ñ","krowa","≈õwinia","owca","koza","kura","gƒô≈õ","indyk","kaczka",
"pszczo≈Ça","osa","biedronka","motyl","wa≈ºka","komar","mr√≥wka","konik_polny","≈õwierszcz","≈õwietlik",
"tulipan","r√≥≈ºa","irys","fio≈Çek","go≈∫dzik","mak","stokrotka","chryzantema","lilia","orchidea",
"piekarnia","apteka","warzywniak","ksiƒôgarnia","kwiaciarnia","fryzjer","szewc","krawiec","poczta","bank",
"muzeum","teatr","kino","filharmonia","galeria","akademia","uniwersytet","szko≈Ça","boisko","sala_gimnastyczna",
"samolot","helikopter","szybowiec","baloniki","spadochron","lotnisko","hangar","wie≈ºa_kontrolna","pas_startowy","tunele",
"pociƒÖg","lokomotywa","wagon","peron","dworzec","biletomat","kasownik","szynobus","metro","tramwaj_linia",
"autobus","taks√≥wka","hulajnoga_elektr","skuter","motocykl","gara≈º","parking","rondo","skrzy≈ºowanie","sygnalizacja",
"aparat","obiektyw","statyw","lampa_b≈Çyskowa","filtr","karta_pamiƒôci","dronek","gimbal","slajd","klisza",
"ciasto","tarta","babeczka","pƒÖczek","ptys","beza","sernik","szarlotka","makowiec","krem√≥wka",
"zupa","ros√≥≈Ç","barszcz","≈ºurek","pomidorowa","og√≥rkowa","groch√≥wka","kapu≈õniak","ch≈Çodnik","ramen",
"pizza","pierogi","kopytka","go≈ÇƒÖbki","kotlet","schabowy","bigos","gulasz","leczo","sa≈Çatka",
"kawa","herbata","lemoniada","kompot","sok","koktajl","kakao","gorƒÖca_czekolada","napar","espresso",
"wied≈∫ma","rycerz","smok","mag","elf","krasnolud","troll","syrena","centaur","feniks",
"nuta","gitara","skrzypce","trƒÖbka","flet","bƒôben","harfa","saksofon","klarnet","banjo",
"piorun","tƒôcza","chmura","mg≈Ça","burza","grad","rosa","szron","szkwa≈Ç","ulewa"
    ]; // 300 wpis√≥w

    // Pomocnicze
    const $ = (sel)=>document.querySelector(sel);
    function shuffle(arr){ const a=[...arr]; for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }
    function pickRandomWord(){ return WORDS[Math.floor(Math.random()*WORDS.length)].replaceAll('_',' '); }
    function note(html){ wordPickedNote.innerHTML = html; }

    // Stan gry
    let state = {
      n: 6,
      word: null,
      impostorIndex: null, // 0..n-1
      order: [],
      current: 0, // indeks w order
      revealed: [],
      delayMs: 5000,
    };

    // Elementy
    const playersCount = $('#playersCount');
    const setup = $('#setup');
    const playerScreen = $('#playerScreen');
    const hostPanel = $('#hostPanel');
    const rules = $('#rules');
    const startBtn = $('#startBtn');
    const randomizeBtn = $('#randomizeBtn');
    const howBtn = $('#howBtn');
    const deferRandom = $('#deferRandom');
    const customWord = $('#customWord');
    const revealOrder = $('#revealOrder');
    const delaySec = $('#delaySec');
    const delayLabel = $('#delayLabel');
    const wordPickedNote = $('#wordPickedNote');
    const playerNum = $('#playerNum');
    const secretWord = $('#secretWord');
    const impostorNote = $('#impostorNote');
    const doneBtn = $('#doneBtn');
    const revealedCount = $('#revealedCount');
    const totalPlayers = $('#totalPlayers');
    const orderChips = $('#orderChips');
    const peekBtn = $('#peekBtn');
    const maskBtn = $('#maskBtn');
    const newRoundBtn = $('#newRoundBtn');
    const chipsBox = $('#chips');
    const overlay = $('#handoffOverlay');
    const countdownEl = $('#countdown');

    function populatePlayerCount(){
      playersCount.innerHTML = '';
      for (let i=1;i<=10;i++){
        const opt = document.createElement('option');
        opt.value = i; opt.textContent = i;
        if (i===6) opt.selected = true;
        playersCount.appendChild(opt);
      }
    }

    function populateOrderOptions(){
      const n = parseInt(playersCount.value,10);
      revealOrder.innerHTML = '';
      const optShuffle = document.createElement('option');
      optShuffle.value = 'shuffle'; optShuffle.textContent = 'Losowa (polecane)';
      revealOrder.appendChild(optShuffle);
      const forward = document.createElement('option');
      forward.value = Array.from({length:n},(_,i)=>i+1).join(',');
      forward.textContent = `1 ‚Üí ${n}`; revealOrder.appendChild(forward);
      const backward = document.createElement('option');
      backward.value = Array.from({length:n},(_,i)=>n-i).join(',');
      backward.textContent = `${n} ‚Üí 1`; revealOrder.appendChild(backward);
      revealOrder.value = 'shuffle';
    }

    function buildOrder(){
      const n = state.n;
      const val = revealOrder.value;
      if (val === 'shuffle') state.order = shuffle(Array.from({length:n},(_,i)=>i+1));
      else state.order = val.split(',').map(Number);
      orderChips.innerHTML = '';
      state.order.forEach((num,i) => {
        const c = document.createElement('div');
        c.className = 'chip';
        c.textContent = `${i+1}. gracz ${num}`;
        orderChips.appendChild(c);
      });
    }

    function renderForCurrent(){
      if (state.current >= state.n){
        secretWord.textContent = 'Koniec ujawniania'; impostorNote.textContent = 'Czas na podpowiedzi!'; playerNum.textContent = '‚Äî';
        playerScreen.classList.add('hidden'); note('Wszyscy poznali swoje role.'); return;
      }
      const idx = state.order[state.current]-1;
      playerNum.textContent = state.order[state.current];
      const isImpostor = (idx === state.impostorIndex);
      secretWord.textContent = isImpostor ? 'IMPOSTOR' : (state.word || '‚Äî').toUpperCase();
      impostorNote.textContent = isImpostor ? 'Jeste≈õ IMPOSTOREM ‚Äì blefuj!' : '';
    }

    function updateHost(){
      const count = state.revealed.filter(Boolean).length;
      revealedCount.textContent = count;
      const tp = document.getElementById('totalPlayers');
      if (tp) tp.textContent = state.n;
      Array.from(orderChips.children).forEach((chip, i) => {
        chip.style.borderColor = i === state.current ? 'var(--accent)' : 'var(--border)';
        chip.style.background = i < state.current ? '#f4f6fc' : '#ffffff';
        chip.style.opacity = i < state.current ? .9 : 1;
      });
    }

    function startRound(){
      state.n = parseInt(playersCount.value,10);
      state.impostorIndex = Math.floor(Math.random()*state.n); // 0..n-1
      state.current = 0;
      state.revealed = Array.from({length: state.n}, ()=>false);
      state.delayMs = parseInt(delaySec.value,10)*1000;
      delayLabel.textContent = delaySec.value;
      buildOrder();

      // Has≈Ço wybieramy dopiero TERAZ:
      if (deferRandom.checked) {
        state.word = pickRandomWord();
        note('Has≈Ço zosta≈Ço wylosowane po starcie (ukryte).');
      } else {
        const cw = (customWord.value || '').trim();
        state.word = cw ? cw : pickRandomWord();
        note(cw ? 'U≈ºyto w≈Çasnego s≈Çowa.' : 'Wylosowano s≈Çowo.');
      }

      setup.classList.add('hidden');
      playerScreen.classList.remove('hidden');
      hostPanel.classList.remove('hidden');
      rules.classList.add('hidden');
      renderForCurrent(); // poka≈º od razu graczowi 1
      updateHost();
    }

    function handoffToNext(){
      const idx = state.order[state.current]-1;
      state.revealed[idx] = true;
      state.current += 1;
      updateHost();
      renderForCurrent();
    }

    // Countdown overlay logic
    let countdownTimer = null;
    function startCountdown(){
      const total = parseInt(delaySec.value,10);
      let remain = total;
      countdownEl.textContent = remain;
      overlay.classList.remove('hidden');
      overlay.setAttribute('aria-hidden','false');
      clearInterval(countdownTimer);
      countdownTimer = setInterval(()=>{
        remain -= 1;
        countdownEl.textContent = remain;
        if (remain <= 0){
          clearInterval(countdownTimer);
          overlay.classList.add('hidden');
          overlay.setAttribute('aria-hidden','true');
          handoffToNext();
        }
      }, 1000);
    }

    // Events
    startBtn.addEventListener('click', startRound);
    howBtn.addEventListener('click', ()=> rules.classList.toggle('hidden'));
    newRoundBtn.addEventListener('click', ()=>{
      setup.classList.remove('hidden'); playerScreen.classList.add('hidden'); hostPanel.classList.add('hidden'); rules.classList.add('hidden'); customWord.focus();
    });
    revealOrder.addEventListener('change', buildOrder);
    delaySec.addEventListener('change', ()=>{ delayLabel.textContent = delaySec.value; });
    doneBtn.addEventListener('click', ()=>{
      secretWord.textContent = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
      impostorNote.textContent = '';
      startCountdown();
    });
    playersCount.addEventListener('change', ()=>{
      populateOrderOptions();
      buildOrder();
      updateHost();
    });
    deferRandom.addEventListener('change', ()=>{
      const enabled = !deferRandom.checked;
      customWord.disabled = !enabled;
      randomizeBtn.disabled = !enabled;
      note(enabled ? 'Mo≈ºesz wpisaƒá w≈Çasne s≈Çowo lub wylosowaƒá przed startem.' : 'Has≈Ço bƒôdzie losowane dopiero po starcie.');
    });
    randomizeBtn.addEventListener('click', ()=>{
      if (randomizeBtn.disabled) return;
      customWord.value = pickRandomWord();
      note(`Wylosowano s≈Çowo: <strong>${customWord.value}</strong>`);
    });

    // Szybkie chipy
    function buildChips(){
      const sample = ["wulkan","latarnia","szachy","dron","opera","tornado","biblioteka","≈ºagiel","igloo","trampolina"];
      chipsBox.innerHTML = '';
      sample.forEach(w=>{
        const d=document.createElement('div'); d.className='chip'; d.textContent=w;
        d.addEventListener('click',()=>{ if (!deferRandom.checked){ customWord.value = w; note(`Wybrano s≈Çowo: <strong>${w}</strong>`);} });
        chipsBox.appendChild(d);
      });
    }

    // PodglƒÖd dla prowadzƒÖcego (1.2s)
    let peekTimeout = null;
    const peekBtnEl = document.getElementById('peekBtn');
    if (peekBtnEl){
      peekBtnEl.addEventListener('click', ()=>{
        const was = secretWord.textContent;
        secretWord.textContent = (state.word||'‚Äî').toUpperCase();
        impostorNote.textContent = '(podglƒÖd prowadzƒÖcego)';
        clearTimeout(peekTimeout);
        peekTimeout = setTimeout(()=>{ renderForCurrent(); }, 1200);
      });
    }
    maskBtn.addEventListener('click', ()=>{ secretWord.textContent='‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢'; impostorNote.textContent=''; });

    // Init
    (function init(){
      populatePlayerCount();
      populateOrderOptions();
      state.n = parseInt(playersCount.value,10);
      buildOrder();
      buildChips();
      note('Has≈Ço zostanie wylosowane po starcie.');
    })();
  </script>
</body>
</html>
